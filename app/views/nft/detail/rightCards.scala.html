@import controllers.actions.LoginState
@import models.analytics.CollectionAnalysis
@import models.master.{Collection, NFT, NFTOwner, SecondaryMarket}
@import views.html.base.buttons._

@(collection: Collection, collectionAnalysis: CollectionAnalysis, nft: NFT, userNFTOwner: Option[NFTOwner], lowestPriceSecondaryMarket: Option[SecondaryMarket], userSecondaryMarket: Option[SecondaryMarket], tokenPrice: Double)(implicit requestHeader: RequestHeader, messagesProvider: MessagesProvider, optionalLoginState: Option[LoginState])

<div class="sticky-top item-sticky">
    <div class="card rightInfoCard">
        @if(optionalLoginState.isDefined) {
            @if(lowestPriceSecondaryMarket.isDefined && userSecondaryMarket.isEmpty) {
                <div class="analysisValue mb-2">@Messages(constants.View.LOWEST_NFT_PRICE)</div>
                <div class="d-flex flex-row gap-1 priceHolder">
                    <img class="align-middle" src="@routes.Assets.versioned("images/NFTCard/token.png")" width="24" height="27"/>
                    <div class="d-flex gap-1 align-items-center flex-wrap">
                        <div class="nft-mantle-price">@utilities.NumericOperation.formatNumber(lowestPriceSecondaryMarket.get.price) @Messages(constants.View.NFT_SALE_TOKEN_UNITS) </div>
                        <div class="nft-dollar-price">(@utilities.NumericOperation.formatNumber(lowestPriceSecondaryMarket.get.price * tokenPrice) $)</div>
                    </div>
                </div>
                <div class="separator"></div>
                @commonPrimaryButton(Messages(constants.View.BUYNOW), JavaScript(s"getForm(jsRoutes.controllers.SecondaryMarketController.buyForm('${nft.id}', '${lowestPriceSecondaryMarket.get.id}'))"), Symbol("class") -> "mt-4")
                @if(userNFTOwner.isDefined && optionalLoginState.get.username == userNFTOwner.get.ownerId && userNFTOwner.get.creatorId != optionalLoginState.get.username && userNFTOwner.get.creatorId != "Mint.E" && nft.isMinted.getOrElse(false)) {
                    <div class="separator"></div>
                    @commonPrimaryButton(Messages(constants.View.SELL_NFT), JavaScript(s"getForm(jsRoutes.controllers.SecondaryMarketController.createForm('${nft.id}'))"), Symbol("class") -> "mt-4")
                }
            }
            @if(lowestPriceSecondaryMarket.isDefined && userSecondaryMarket.isDefined) {
                @if(lowestPriceSecondaryMarket.get.id == userSecondaryMarket.get.id) {
                    <div class="analysisValue mb-2">@Messages(constants.View.LOWEST_NFT_PRICE)</div>
                    <div class="d-flex flex-row gap-1 priceHolder">
                        <img class="align-middle" src="@routes.Assets.versioned("images/NFTCard/token.png")" width="24" height="27"/>
                        <div class="d-flex gap-1 align-items-center flex-wrap">
                            <div class="nft-mantle-price">@utilities.NumericOperation.formatNumber(lowestPriceSecondaryMarket.get.price) @Messages(constants.View.NFT_SALE_TOKEN_UNITS)</div>
                            <div class="nft-dollar-price">(@utilities.NumericOperation.formatNumber(lowestPriceSecondaryMarket.get.price * tokenPrice) $)</div>
                        </div>
                    </div>
                    <div class="separator"></div>
                    @commonPrimaryButton(Messages(constants.View.CANCEL_ORDER), JavaScript(s"getForm(jsRoutes.controllers.SecondaryMarketController.cancelForm('${nft.id}', '${lowestPriceSecondaryMarket.get.id}'))"), Symbol("class") -> "mt-4")
                } else {
                    <div class="analysisValue mb-2">@Messages(constants.View.LOWEST_NFT_PRICE)</div>
                    <div class="d-flex flex-row gap-1 priceHolder">
                        <img class="align-middle" src="@routes.Assets.versioned("images/NFTCard/token.png")" width="24" height="27"/>
                        <div class="d-flex gap-1 align-items-center flex-wrap">
                            <div class="nft-mantle-price">@utilities.NumericOperation.formatNumber(lowestPriceSecondaryMarket.get.price) @Messages(constants.View.NFT_SALE_TOKEN_UNITS)</div>
                            <div class="nft-dollar-price">(@utilities.NumericOperation.formatNumber(lowestPriceSecondaryMarket.get.price * tokenPrice) $)</div>
                        </div>
                    </div>
                    <div class="separator"></div>
                    @commonPrimaryButton(Messages(constants.View.BUYNOW), JavaScript(s"getForm(jsRoutes.controllers.SecondaryMarketController.buyForm('${nft.id}', '${lowestPriceSecondaryMarket.get.id}'))"), Symbol("class") -> "mt-4")
                    <div class="separator"></div>
                    <div class="analysisValue mb-2">@Messages(constants.View.SELLER_NFT_PRICE)</div>
                    <div class="d-flex flex-row gap-1 priceHolder">
                        <img class="align-middle" src="@routes.Assets.versioned("images/NFTCard/token.png")" width="24" height="27"/>
                        <div class="d-flex gap-1 align-items-center flex-wrap">
                            <div class="nft-mantle-price">@utilities.NumericOperation.formatNumber(userSecondaryMarket.get.price) @Messages(constants.View.NFT_SALE_TOKEN_UNITS)</div>
                            <div class="nft-dollar-price">(@utilities.NumericOperation.formatNumber(userSecondaryMarket.get.price * tokenPrice) $)</div>
                        </div>
                    </div>
                    <div class="separator"></div>
                    @commonSecondaryButton(Messages(constants.View.CANCEL_ORDER), JavaScript(s"getForm(jsRoutes.controllers.SecondaryMarketController.cancelForm('${nft.id}', '${lowestPriceSecondaryMarket.get.id}'))"), Symbol("class") -> "mt-4")
                }
            }
            @if(lowestPriceSecondaryMarket.isEmpty && userSecondaryMarket.isEmpty) {
                @if(userNFTOwner.isDefined && optionalLoginState.get.username == userNFTOwner.get.ownerId && userNFTOwner.get.creatorId != optionalLoginState.get.username && userNFTOwner.get.creatorId != "Mint.E" && nft.isMinted.getOrElse(false)) {
                    @commonPrimaryButton(Messages(constants.View.SELL_NFT), JavaScript(s"getForm(jsRoutes.controllers.SecondaryMarketController.createForm('${nft.id}'))"))
                } else {
                    @Messages(constants.View.CANNOT_BE_SOLD)
                }
            }
        } else {
            @if(lowestPriceSecondaryMarket.isDefined) {
                <div class="analysisValue mb-2">@Messages(constants.View.LOWEST_NFT_PRICE)</div>
                <div class="d-flex flex-row gap-1 priceHolder">
                    <img class="align-middle" src="@routes.Assets.versioned("images/NFTCard/token.png")" width="24" height="27"/>
                    <div class="d-flex gap-1 align-items-center flex-wrap">
                        <div class="nft-mantle-price">@utilities.NumericOperation.formatNumber(lowestPriceSecondaryMarket.get.price) @Messages(constants.View.NFT_SALE_TOKEN_UNITS)</div>
                        <div class="nft-dollar-price">(@utilities.NumericOperation.formatNumber(lowestPriceSecondaryMarket.get.price * tokenPrice) $)</div>
                    </div>
                </div>
                <div class="separator"></div>
                @commonPrimaryButton(Messages(constants.View.BUYNOW), JavaScript(s"getForm(jsRoutes.controllers.AccountController.signInWithCallbackForm('/market/${collection.id}'))"), Symbol("class") -> "mt-4")
            } else {
                <div class="analysisValue">@Messages(constants.View.NOT_ON_SALE)</div>
            }
        }
    </div>
</div>